drop table if exists ATS_USR_TBL cascade;
CREATE TABLE ATS_USR_TBL (
	USR_ID int GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	USR_NM varchar(100) NOT NULL,
	USR_EMAIL varchar(100) NOT NULL,
	USR_PASSWD varchar(45) DEFAULT NULL NULL,
	USR_STATUS int NOT NULL,
	USR_TYPE int DEFAULT NULL NULL,
	USR_CREATE_AT timestamp(3) DEFAULT now() NOT NULL,
	USR_UPD_AT timestamp(3) DEFAULT NULL NULL,
	CONSTRAINT PK_ATS_USR_TBL PRIMARY KEY (USR_ID),
	CONSTRAINT USERNAME_UNIQUE UNIQUE (USR_NM)
);

drop table if exists ATS_CTS_ACT_LOG_TBL cascade;
CREATE TABLE ATS_CTS_ACT_LOG_TBL (
	ACT_ID int GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	USR_ID int DEFAULT NULL NULL,
	MAP_ID int NOT NULL,
	ACT_EVN_AT timestamp(3) DEFAULT now() NOT NULL,
	ACT_TYPE int NOT NULL,
	ACT_RESULT int NOT NULL,
	AT_DTL varchar(500) DEFAULT NULL NULL,
	ACT_IP_ADR varchar(39) NOT NULL,
	CONSTRAINT PK_ATS_CTS_ACT_LOG_TBL PRIMARY KEY (ACT_ID)
);

drop table if exists ATS_ACT_TBL cascade;
CREATE TABLE ATS_ACT_TBL (
	ACT_ID int GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	USR_ID int NOT NULL,
	ACT_EVN_AT timestamp(3) DEFAULT now() NOT NULL,
	ACT_TYPE int NOT NULL,
	ACT_RESULT int NOT NULL,
	AT_DTL varchar(500) DEFAULT NULL NULL,
	ACT_IP_ADR varchar(39) NOT NULL,
	CONSTRAINT PK_ATA_ACT_TBL PRIMARY KEY (ACT_ID)
);

drop table if exists ATS_SGN_TBL cascade;
CREATE TABLE ATS_SGN_TBL (
	SGN_ID int NOT NULL,
	USR_ID int NOT NULL,
	SGN_NM varchar(255) NOT NULL,
	SGN_CREATE_AT timestamp(3) DEFAULT now() NOT NULL,
	SGN_UPT_AT timestamp(3) DEFAULT NULL NULL,
	SGN_IMG bytea NOT NULL,
	CONSTRAINT PK_ATS_SGN_TBL PRIMARY KEY (SGN_ID),
	CONSTRAINT FK_SIGN_USER FOREIGN KEY (USR_ID) REFERENCES ATS_USR_TBL(USR_ID) ON DELETE CASCADE
);

drop table if exists ATS_CTS_USR_CRT_MAP_TBL cascade;
CREATE TABLE ATS_CTS_USR_CRT_MAP_TBL (
	MAP_ID int GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	MAP_REF varchar(100) NOT NULL,
	USR_ID int NOT NULL,
	MAP_UUID varchar(36) DEFAULT NULL NULL,
	MAP_ENC_AKEY varchar(255) DEFAULT NULL NULL,
	MAP_STATUS int DEFAULT '0' NULL,
	MAP_CREATE_AT timestamp(3) DEFAULT now() NOT NULL,
	MAP_UPD_AT timestamp(3) DEFAULT NULL NULL,
	CONSTRAINT ATS_CTS_USR_CRT_MAP_TBL_REF_UK UNIQUE (MAP_REF),
	CONSTRAINT PK_ATS_CTS_USR_CRT_MAP_TBL PRIMARY KEY (MAP_ID),
	CONSTRAINT ATS_CTS_USR_CRT_MAP_TBL_IBFK FOREIGN KEY (USR_ID) REFERENCES ATS_USR_TBL(USR_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

drop table if exists ATS_CFG_TBL cascade;
CREATE TABLE ATS_CFG_TBL (
	NAME varchar(255) NOT NULL,
	VALUE varchar(255) NOT NULL,
	CONSTRAINT PK_ATS_CFG_TBL PRIMARY KEY (NAME)
);

drop table if exists ATS_DAT_TBL cascade;
CREATE TABLE ATS_DAT_TBL (
	NAME varchar(255) NOT NULL,
	VALUE bytea NULL,
	CONSTRAINT PK_ATS_DAT_TBL PRIMARY KEY (NAME)
);

drop table if exists ATS_SGN_FLD_TBL cascade;
CREATE TABLE ATS_SGN_FLD_TBL (
	SGN_FLD_ID int GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	SGN_ID int NOT NULL,
	SGN_FLD_TYPE int NOT NULL,
	SGN_FLD_X int NOT NULL,
	SGN_FLD_Y int NOT NULL,
	SGN_FLD_W int NOT NULL,
	SGN_FLD_H int NOT NULL,
	CONSTRAINT PK_ATS_SGN_FLD_TBL PRIMARY KEY (SGN_FLD_ID),
	CONSTRAINT FK_FIELD_SIGNATURE FOREIGN KEY (SGN_ID) REFERENCES ATS_SGN_TBL(SGN_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

drop table if exists ATS_CRT_TBL cascade;
CREATE TABLE ATS_CRT_TBL (
	CRT_ID int GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	USR_ID int NOT NULL,
	CRT_NM varchar(255) NOT NULL,
	CRT_STS int DEFAULT 0 NOT NULL,
	CRT_ISSUER varchar(255) NOT NULL,
	CRT_SUBJECT varchar(500) NOT NULL,
	CRT_SERIAL varchar(135) DEFAULT NULL NULL,
	CRT_HASH varchar(128) DEFAULT NULL NULL,
	CRT_ACTIVE_AT timestamp(3) DEFAULT NULL NULL,
	CRT_EXPIRY_AT timestamp(3) DEFAULT NULL NULL,
	CRT_CONTENT bytea DEFAULT NULL NULL,
	CRT_ENABLE_OTP SMALLINT DEFAULT 1 NOT NULL,
	CRT_ACCESS_KEY varchar(500) DEFAULT NULL NULL,
	CRT_UUID varchar(36) DEFAULT NULL NULL,
	CRT_LASTUSE_AT timestamp(3) DEFAULT NULL NULL,
	CRT_NUM_OF_USE int DEFAULT 0 NULL,
	CRT_CREATE_AT timestamp(3) DEFAULT now() NOT NULL,
	CRT_UPD_AT timestamp(3) DEFAULT NULL NULL,
	CONSTRAINT PK_ATS_CRT_TBL PRIMARY KEY (CRT_ID),
	CONSTRAINT FK_CRT_USRID FOREIGN KEY (USR_ID) REFERENCES ATS_USR_TBL(USR_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

drop table if exists ATS_SIGN_TBL cascade;
CREATE TABLE ATS_SIGN_TBL (
	SIGN_ID int GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	SIGN_CREATE_AT timestamp(3) DEFAULT now() NOT NULL,
	USR_ID int NOT NULL,
	SIGN_IP_ADR varchar(39) NOT NULL,
	CRT_NM varchar(255) NOT NULL,
	SIGN_DOC_TITLE varchar(255) NOT NULL,
	SIGN_REASON varchar(255) DEFAULT NULL NULL,
	SIGN_DIGEST bytea NOT NULL,
	SIGN_DIGEST_TYPE int DEFAULT 0 NOT NULL,
	SIGN_REF varchar(45) NOT NULL,
	SIGN_DEV_ID varchar(255) DEFAULT NULL NULL,
	SIGN_DEV_NM varchar(255) DEFAULT NULL NULL,
	CONSTRAINT PK_ATS_SIGN_TBL PRIMARY KEY (SIGN_ID)
);

drop table if exists ATS_SES_TBL cascade;
CREATE TABLE ATS_SES_TBL (
	SES_ID varchar(64) DEFAULT 0 NOT NULL,
	USR_ID int NOT NULL,
	USR_NM varchar(45) NOT NULL,
	SES_STATUS int DEFAULT 0 NOT NULL,
	SES_TYPE int DEFAULT 0 NOT NULL,
	SES_IP_ADR varchar(39) DEFAULT '0' NOT NULL,
	SES_CREATE_AT timestamp(3) DEFAULT now() NOT NULL,
	SES_UPD_AT timestamp(3) NOT NULL,
	CONSTRAINT PK_ATS_SES_TBL PRIMARY KEY (SES_ID)
);

drop table if exists ATS_USR_PFL_TBL cascade;
CREATE TABLE ATS_USR_PFL_TBL (
	USR_ID int NOT NULL,
	PFL_INFO bytea NOT NULL,
	PFL_CREATE_TS timestamp(3) DEFAULT now() NOT NULL,
	PFL_UPD_TS timestamp(3) DEFAULT NULL NULL,
	CONSTRAINT FK_PFL_USR_ID FOREIGN KEY (USR_ID) REFERENCES ATS_USR_TBL(USR_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

drop table if exists ATS_CRL_TBL cascade;
CREATE TABLE ATS_CRL_TBL (
	CRL_CA varchar(255) NOT NULL,
	CRL_URL varchar(500) DEFAULT NULL NULL,
	CRL_NXT_UPD_AT timestamp(3) DEFAULT NULL NULL,
	CRL_CREATE_AT timestamp(3) DEFAULT now() NOT NULL,
	CRL_UPD_AT timestamp(3) DEFAULT NULL NULL,
	CONSTRAINT PK_ATS_CRL_TBL PRIMARY KEY (CRL_CA)
);

drop table if exists ATS_IMG_TBL cascade;
CREATE TABLE ATS_IMG_TBL (
	IMG_ID int GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	USR_ID int NOT NULL,
	IMG_DATA bytea NOT NULL,
	CONSTRAINT PK_ATS_IMG_TBL PRIMARY KEY (IMG_ID),
	CONSTRAINT FK_SIGNIMG_USR FOREIGN KEY (USR_ID) REFERENCES ATS_USR_TBL(USR_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

drop table if exists ATS_QTA_TBL cascade;
CREATE TABLE ATS_QTA_TBL (
	QTA_ID int GENERATED BY DEFAULT AS IDENTITY(START WITH 1 INCREMENT BY 1) NOT NULL,
	USR_ID int NOT NULL,
	QTA_COUNT int DEFAULT '0' NULL,
	QTA_EXPIRY_AT timestamp(3) DEFAULT NULL NULL,
	QTA_UPDATE_AT timestamp(3) DEFAULT now() NOT NULL,
	CONSTRAINT PK_ATS_QTA_TBL PRIMARY KEY (QTA_ID),
	CONSTRAINT USR_ID_UNIQUE UNIQUE (USR_ID)
);

drop table if exists ATS_DTH_SIG_TBL cascade;
CREATE TABLE ATS_DTH_SIG_TBL (
	REF_KEY varchar(20) NOT NULL,
	DOC_TP varchar(20) NOT NULL,
	HASH_DAT bytea DEFAULT NULL NULL,
	SIG_DAT bytea DEFAULT NULL NULL,
	SIG_DAT_CLS varchar(100) DEFAULT NULL NULL,
	DOC_DAT bytea DEFAULT NULL NULL,
	CREATE_AT timestamp(3) DEFAULT now() NOT NULL,
	CONSTRAINT PK_ATS_DTH_SIG_TBL PRIMARY KEY (REF_KEY)
);